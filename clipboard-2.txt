import subprocess
import sys
from flask import Flask
from telegram import Bot

# Fonction pour installer les dépendances si elles ne sont pas présentes
def install_requirements():
    required_packages = [
        "Flask==2.3.2",
        "python-telegram-bot==20.3"
    ]
    for package in required_packages:
        subprocess.check_call([sys.executable, "-m", "pip", "install", package])

# Installation des packages avant de lancer le serveur Flask
install_requirements()

# Initialisation de l'application Flask
app = Flask(__name__)

# Configuration Telegram
TELEGRAM_TOKEN = "7402831359:AAHwrtwwqOhxsP4iajcx9-zGXev_DGDMlPY"
CHAT_ID = "1963161645"
bot = Bot(token=TELEGRAM_TOKEN)

# Route principale
@app.route("/")
def home():
    try:
        bot.send_message(chat_id=CHAT_ID, text="Déploiement réussi sur Render avec installation automatique des dépendances !")
        return "Déploiement réussi sur Render ! Le message Telegram a été envoyé."
    except Exception as e:
        return f"Déploiement réussi, mais une erreur s'est produite : {e}"

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)